<% let count = 0 %>

<%- include('../layouts/header.ejs') %>

<div class="page-wrapper">
	
	<%- include('../layouts/navbar.ejs') %>

     <main class="main">
        	<div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
        		<div class="container">
        			<h1 class="page-title text-black-50  ">Checkout<span>Shop</span></h1>
        		</div><!-- End .container -->
        	</div><!-- End .page-header -->
            <nav aria-label="breadcrumb" class="breadcrumb-nav">
                <div class="container">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                        <li class="breadcrumb-item"><a href="#">Cart</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Checkout</li>
                    </ol>
                </div><!-- End .container -->
            </nav><!-- End .breadcrumb-nav -->

				<!-- Modal For Address Add-->

                                        <div class="modal fade" id="address" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">   <!-- Add Addres Modal -->

                                          <div class="modal-dialog">
                                            <div class="modal-content">

                                              <div class="modal-header">
                                                <h6 class="modal-title " id="exampleModalLabel">Add Address</h6>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                              </div>

                                              <div class="modal-body">

                                                <form method="post" style="padding-left: 15px;padding-right: 15px;" id="addform">

											      <p id="msg" hidden ><%= msgg %></p>
                                                  
                                                  <div class="row">

                                                  <div class="col-lg-6">
                                                      <label for="name" class="col-form-label text-black">Name *</label>
                                                      <input type="text" class="form-control" name="name" id="name" placeholder="Enter your Name" required>
                                                  </div>

                                                  <div class="col-lg-6">
                                                      <label for="phone" class="col-form-label text-black">Mobile Number *</label>
                                                      <input type="text" class="form-control" name="phone" id="phone" placeholder="Enter your Mobile" required>
                                                  </div>

                                                  <div class="col-lg-6">
                                                      <label for="locality" class="col-form-label text-black">Loacality *</label>
                                                      <input type="text" class="form-control" name="locality" id="locality" placeholder="Enter your Locality" required>
                                                  </div>

                                                  <div class="col-lg-6">
                                                      <label for="pincode" class="col-form-label text-black">Pincode *</label>
                                                      <input type="text" class="form-control" name="pincode" id="pincode" placeholder="Enter your pincode" required>
                                                  </div>

                                                  </div>

                                                  <div class="col-lg-12">

                                                    <label for="display-name" class="requird text-dark"  >Address *</label>
                                                    <textarea type="text"  id="" class="form-control " rows="3" placeholder="Enter your Address" name="address" required></textarea>

                                                  </div>

                                                  <div class="row mb-1">

                                                     <div class="col-lg-6">
                                                      <label for="city" class="col-form-label text-black">City *</label>
                                                      <input type="text" class="form-control" name="city" id="city" placeholder="Enter your City" required>
                                                  </div>

                                                  <div class="col-lg-6">
                                                      <label for="state" class="col-form-label text-black">State *</label>
                                                      <input type="text" class="form-control" name="state" id="state" placeholder="Enter your State" required>
                                                  </div>

                                                  </div>
                                                  
                                              </form>
                                              
                                              </div>

                                              <div class="modal-footer">
												<input type="hidden" value="<%= userData._id %>" id="validUserId">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                <button type="submit" class="btn btn-primary" onclick="validateForm()">Add</button>
                                              </div>

                                            </div>
                                          </div>

                                	</div>

						<!--- End Add Address -->

			
			<!-- Button trigger modal -->
			
			<!-- <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#changeAddressModal">
				Launch demo modal
			</button> -->
			
		<!--Modal Choose Address-->

		<div class="modal fade" id="changeAddressModal" tabindex="-1" aria-labelledby="changeAddressModal" aria-hidden="true">

			<div class="modal-dialog">

			<div class="modal-content">

				<div class="modal-header">
					<h1 class="modal-title fs-5" id="exampleModalLabel">Choose Address</h1>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>

			    <div class="modal-body">
					
					<div class="row">
						
						<% for (let i = 0; i < addres?.addresss?.length; i++) { %>
							
							<% if (addres?.addresss[i]?.status == false) { %>
                                                                                                                                                                                                                                                                               
								<div class="col-lg-5" style="margin: auto;">

									<div class="card card-dashboard mt-2 style" style="width: 100;box-shadow:1px 1px 4px 0px#888888;" onclick="addresChoose('<%= addres.addresss[i]._id %>')">
													
										<div class="card-body" style="cursor: pointer;">

												<!-- <input type="checkbox" class="card-checkbox"> -->

												<!-- <button type="button" class="close" aria-label="Close"  style="font-size: 23px;padding-bottom: 20px;" onclick="deleteAdd('<%= userData._id %>' , '<%= addres.addresss[i]._id %>')">
													<span aria-hidden="true">&times;</span>
												</button> -->

												<!-- <span style="cursor: pointer; display: flex; justify-content: end;" data-bs-toggle="modal" data-bs-target="#changeAddressModal">Change</span> -->

												<h3 class="card-title">Address</h3><!-- End .card-title -->

												<p><span style="font-size: 1vw;"><%= addres.addresss[i].name %></span></p>
												<p><span><%= addres.addresss[i].address %></span>,
												<br><span><%= addres.addresss[i].locality %>,</span>
												<span><%= addres.addresss[i].city %>,</span>
												<span><%= addres.addresss[i].state %>,</span>
												<span><%= addres.addresss[i].pincode %> </span>
												<br>
												<span>Phone: <%= addres.addresss[i].phone %> </span>
											</p>

											<a herf="#" style="cursor: pointer; color: rgb(207, 149, 77);" data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="editAddress('<%= addres.addresss[i]._id %>')">Edit<i class="icon-edit"></i></a>

										</div><!-- End .card-body -->

									</div><!-- End .card-dashboard -->

								</div><!-- End .col-lg-6 -->

							<%	} else if(addres.addresss.length <= 1) { %>

								<div class="p-3">

									<p class="text-center ">Add Another Address To Change <a href="/address">Click Here</a></p>

								</div>

							<% } %>

						<% } %>
							
						</div>

						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
							<!-- <button type="button" class="btn btn-primary">Save changes</button> -->
						</div>

					</div>

				</div>
				
			</div>
			
		</div>
		
            <div class="page-content">
				
            	<div class="checkout">

	                <div class="container">

            			<!-- <div class="checkout-discount">

            				<form action="useCoupen" method="post">

        						<input type="text" class="form-control" required id="checkout-discount-input">

            					<label for="checkout-discount-input" class="text-truncate">Have a coupon? <span>Click here to enter your code</span></label>

            				</form>

            			</div>End .checkout-discount -->

					<!---- Available Coupen Modal --->

					<!-- <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#coupenModal"> -->

					<span class="text-primary " data-bs-toggle="modal" data-bs-target="#coupenModal" style="cursor: pointer;">Available Coupens</span>

					<!-- </button> -->

					<!-- Modal -->

					<div class="modal fade" id="coupenModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">

					<div class="modal-dialog">

						<div class="modal-content">

						<div class="modal-header">
							<h1 class="modal-title fs-5" id="exampleModalLabel">Available Coupens</h1>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>

						<div class="modal-body p-5 h-100 ">

							<div class="row w-100 g-3 ">

                            <% coupenData.slice().reverse().forEach((val,i) => { %>
            
                                <div class="flip-card col-lg-3" >
                                                                    
                                    <div class="flip-card-inner">
                                                                        
                                    	<div class="flip-card-front" style="background: url('/productImage/<%= val.image %>'); background-size: cover;">

                                            <p class="title text-white" ><%= val.name %></p>
                                                                            
                                        </div>
                                                                        
                                        <div class="flip-card-back">

                                            <p class="title text-white pb-1"><%= val.name %></p>
                                            <h6 class="text-dark" style="font-weight: bold;"><%= val.discountt %>% OFF</h6>

                                            <di class="coupon-row pt-1">

                                                <span id="cpnCode"><%= val.coupenId %></span>
                                                <span onclick="copyCode('<%= val.coupenId %>',this)" id="cpnBtn">Copy Code</span>

                                            </di>

                                        </div>

                                     </div>
                                                                        
                                </div>
                                                                    
                            <%  }); %>

							</div>
							
						</div>

						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
							<!-- <button type="button" class="btn btn-primary">Save changes</button> -->
						</div>

						</div>

					</div>

					</div>

					<!-- Coupen Area -->

					<div class="cart-discount">
										
						<form action="/useCoupen" method="post">

							<p id="msg"><%= msgg %></p>

							<span id="p"></span>
							
						<% if (cartData.percentage == 0) { %>

							<div class="input-group">

								<input type="text" class="form-control" name="coupen" required oninput="coupenCheck(this)" placeholder="coupon code">

								<div class="input-group-append">
									<button class="btn btn-outline-primary-2 mb-3 " id="btn" type="submit"><i class="icon-long-arrow-right"></i></button>
								</div><!-- .End .input-group-append -->

							</div><!-- End .input-group -->
								
						<%	} else { %>

							<div class="input-group">

								<input type="text" class="form-control" name="coupen" required placeholder="coupon code" disabled >

								<div class="input-group-append">
									<button class="btn btn-outline-danger mb-3 " id="btn" onclick="removeCoupen()" type="submit">Remove</button>
								</div><!-- .End .input-group-append -->

							</div><!-- End .input-group -->

						<% } %>

							<span class="" id="g"></span>
							
						</form>
					</div><!-- End .cart-discount -->
					
					<!--Coupen End-->

						<% if (!locals.addres || locals.addres.addresss.length == 0) { %>

						  		<!-- Modal For Address Add-->

								<!--- End Add Address -->
							
		                	<div class="row"> 

		                		<div class="col-lg-9">

		                			<!-- <h2 class="checkout-title">Billing Details</h2>End .checkout-title -->

									<button type="button" class="btn btn-primary mt-3 justify-content-center " data-bs-toggle="modal" data-bs-target="#address" data-bs-whatever="@mdo">Add Address</button>

									<div class="text-center text-info" style="margin-top: 20rem;"><p>Click The Add Address Button to Add Address</p></div><!--Message-->

		                				<div class="row">

		                					<div class="col-sm-6">

		                						<!-- <label>Name *</label>
		                						<input type="text" class="form-control" name="name" required> -->

		                					</div><!---End .col-sm-6-->

		                					<div class="col-sm-6">
												
		                						<!-- <label>Mobile Number *</label>
		                						<input type="text" class="form-control" name="phone" required> -->

		                					</div><!--End .col-sm-6 -->

		                				</div><!---End .row -->
 
	            						<!-- <label>Company Name (Optional)</label>
	            						<input type="text" class="form-control">

	            						<label>Country *</label>
	            						<input type="text" class="form-control" required>

	            						<label>Street address *</label>
	            						<input type="text" class="form-control" placeholder="House number and Street name" required>
	            						<input type="text" class="form-control" placeholder="Appartments, suite, unit etc ..." required>  -->

	            						<div class="row">

		                					<!-- <div class="col-sm-6">
		                						<label>Locality *</label>
		                						<input type="text" class="form-control" name="locality" required>
		                					</div>End .col-sm-6

		                					<div class="col-sm-6">
		                						<label>City *</label>
		                						<input type="text" class="form-control" name="city" required>
		                					</div>End .col-sm-6 -->

		                				</div><!--End .row -->

		                				<div class="row">

		                					<!-- <div class="col-sm-6">
		                						<label>State *</label>
		                						<input type="text" class="form-control" name="state" required>
		                					</div>End .col-sm-6

		                					<div class="col-sm-6">
		                						<label>Pincode *</label>
		                						<input type="tel" class="form-control" name="pincode" required>
		                					</div>End .col-sm-6 -->

		                				</div><!--End .row -->

	                					<!-- <label>Email address *</label>
	        							<input type="email" class="form-control" required> 

	        							 <div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input" id="checkout-create-acc">
											<label class="custom-control-label" for="checkout-create-acc">Create an account?</label>
										</div>End .custom-checkbox

										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input" id="checkout-diff-address">
											<label class="custom-control-label" for="checkout-diff-address">Ship to a different address?</label>
										</div>End .custom-checkbox -->

	                					<!-- <label>Address</label> -->

	        							<!-- <textarea class="form-control" cols="30" rows="4" name="address" placeholder="enter your address"></textarea> -->

									</div><!--End .col-lg-9-->

					<% } else { %>
		
						<div class="row"> 

            			<!-- <form action="#"> -->

		                		<div class="col-lg-9">

                                    <div class="row">
										
								     <% for (let i = 0; i < addres.addresss.length; i++) { %>

										<% if (addres.addresss[i].status == true ) { %>
                                                                                                                                                                                                                                                                               
                                         <div class="col-lg-5">

                                            <div class="card card-dashboard mt-1">
												
                                                <div class="card-body" style="padding: 20px; cursor: pointer;">

											  <!-- <input type="checkbox" class="card-checkbox mb-2 "> -->

													<!-- <button type="button" class="close" aria-label="Close"  style="font-size: 23px;padding-bottom: 20px;" onclick="deleteAdd('<%= userData._id %>' , '<%= addres.addresss[i]._id %>')">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button> -->

													<span style="cursor: pointer; display: flex; justify-content: end;" data-bs-toggle="modal" data-bs-target="#changeAddressModal">Change</span>

                                                    <h3 class="card-title">Address</h3><!-- End .card-title -->

                                                   <span s><%= addres.addresss[i].name %></span>
													<p><span><%= addres.addresss[i].address %></span>,
														<br><span><%= addres.addresss[i].locality %>,</span>
														<span><%= addres.addresss[i].city %>,</span>
														<span><%= addres.addresss[i].state %>,</span>
														<span><%= addres.addresss[i].pincode %> </span>
														<br>
														<span>Phone: <%= addres.addresss[i].phone %> </span>
													</p>

												    <a herf="#" style="cursor: pointer; color: rgb(207, 149, 77);" data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="editAddress('<%= addres.addresss[i]._id %>')">Edit<i class="icon-edit"></i></a>

                                                 </div><!-- End .card-body -->

                                            </div><!-- End .card-dashboard -->

                                        	</div><!-- End .col-lg-6 -->

									    <% } else if (locals.addres.addresss.length == 1 || locals.addres.addresss[0].status == false) { %>

											<% count++ %>

												<% if (count == addres.addresss.length) { %>

														<div class="row"> 

															<div class="col-lg-9">

														<!-- <h2 class="checkout-title">Billing Details</h2>End .checkout-title -->

															<button type="button" class="btn btn-primary mt-3 justify-content-center " data-bs-toggle="modal" data-bs-target="#address" data-bs-whatever="@mdo">Add Address</button>

																<div class="text-center text-info" style="margin-top: 20rem;"><p>Click The Add Address Button to Add Address</p></div><!--Message-->


															</div>

														</div>
													
											    <%	} %>
												
										<% } %>

											<!--Edit Address Modal-->

											  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">

                                                  <div class="modal-dialog">

                                                    <div class="modal-content">

                                                      <div class="modal-header">
                                                        <h1 class="modal-title fs-5" id="exampleModalLabel">Edit Address</h1>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                      </div>

                                                      <div class="modal-body" style="padding: 13px;">

                                                        <form action="verifyEditAddCheckout" method="post" style="padding-left: 15px;padding-right: 15px;" id="">

												         <p class="" hidden id="msg"><%= msgg %></p>

                                                        <div class="row">

                                                        <div class="col-lg-6">
                                                            <label for="name" class="col-form-label text-black">Name *</label>
                                                            <input type="text" class="form-control" name="name" id="namee" placeholder="Enter your Name" required>
                                                        </div>

                                                        <div class="col-lg-6">
                                                            <label for="phone" class="col-form-label text-black">Mobile Number *</label>
                                                            <input type="text" class="form-control" name="phone" id="phonee" placeholder="Enter your Mobile" required>
                                                        </div>

                                                        <div class="col-lg-6">
                                                            <label for="locality" class="col-form-label text-black">Loacality *</label>
                                                            <input type="text" class="form-control" name="locality" id="localityy" placeholder="Enter your Locality" required>
                                                        </div>

                                                        <div class="col-lg-6">
                                                            <label for="pincode" class="col-form-label text-black">Pincode *</label>
                                                            <input type="text" class="form-control" name="pincode" id="pincodee" placeholder="Enter your pincode" required>
                                                        </div>

                                                        </div>

                                                        <div class="col-lg-12">

                                                          <label for="display-name" class=" requird text-dark">Address *</label>
                                                          <textarea type="text" style="color: gray;"  id="addresssss" class="form-control" rows="3" placeholder="Enter your Address" name="address" required></textarea>

                                                        </div>

                                                        <div class="row mb-1">

                                                          <div class="col-lg-6">
                                                            <label for="city" class="col-form-label text-black">City *</label>
                                                            <input type="text" class="form-control" name="city" id="cityy" placeholder="Enter your City" required>
                                                        </div>

                                                        <div class="col-lg-6">
                                                            <label for="state" class="col-form-label text-black">State *</label>
                                                            <input type="text" class="form-control" name="state" id="statee" placeholder="Enter your State" required>
                                                        </div>

                                                        </div>

                                                        <input type="hidden" name="id" id="idd">
														
														<div class="modal-footer">
															<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
															<button type="submit" class="btn btn-primary">Save changes</button>
														</div>
																										
                                                    </form>
                                                                                                    
                                                      </div>

                                                    </div>

                                                  </div>

                                                </div>
									
									<%  } %>

                                    </div><!-- End .row -->
									
									<button type="button" class="btn btn-primary mb-3 " data-bs-toggle="modal" data-bs-target="#address" data-bs-whatever="@mdo">ADD Address</button>
                                        <!--modal for address ADD-->
                                        <div class="modal fade" id="address" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                          <div class="modal-dialog">
                                            <div class="modal-content">
                                              <div class="modal-header">
                                                <h1 class="modal-title fs-5" id="exampleModalLabel">Add Address</h1>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                              </div>
                                              <div class="modal-body">
                                                <form style="padding-left: 15px;padding-right: 15px;" id="addform">
                                                  
                                                  <div class="mb-3">
                                                      <label for="address" class="col-form-label text-black ">Address:</label>
                                                      <input type="text" class="form-control" name="address" oninput="validate()"  id="ad" placeholder="Enter your Address">
                                                      <p id="add"></p>
                                                  </div>
                                                  <div class="mb-3">
                                                      <label for="city" class="col-form-label text-black">City:</label>
                                                      <input type="text" class="form-control" name="city" id="city" placeholder="Enter your City Name">
                                                  </div>
                                                  <div class="mb-3">
                                                      <label for="state" class="col-form-label text-black">State:</label>
                                                      <input type="text" class="form-control" name="state" id="state" placeholder="Enter your State Name">
                                                  </div>
                                                  <div class="mb-3">
                                                      <label for="pincode" class="col-form-label text-black">Pincode:</label>
                                                      <input type="text" class="form-control" name="pincode" id="pincode" placeholder="Enter your pincode">
                                                  </div>
                                                  
                                                  <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                    <button type="button" class="btn btn-primary"data-bs-dismiss="modal" onclick="addform('<%= userData._id %>');addresChoose('<%= addres.addresss._id %>')">Add</button>

												



                                                  </div>
                                                </form>
                                                </div>
                                              
                                              </div>
                                          </div>
                                        </div>
		                			<!-- <h2 class="checkout-title">Billing Details</h2>End .checkout-title -->

		                				<div class="row">

		                					<div class="col-sm-6">

		                						<!-- <label>Name *</label>
		                						<input type="text" class="form-control" name="name" required> -->

		                					</div><!---End .col-sm-6-->

		                					<div class="col-sm-6">
												
		                						<!-- <label>Mobile Number *</label>
		                						<input type="text" class="form-control" name="phone" required> -->

		                					</div><!--End .col-sm-6 -->

		                				</div><!---End .row -->
 
	            						<!-- <label>Company Name (Optional)</label>
	            						<input type="text" class="form-control">

	            						<label>Country *</label>
	            						<input type="text" class="form-control" required>

	            						<label>Street address *</label>
	            						<input type="text" class="form-control" placeholder="House number and Street name" required>
	            						<input type="text" class="form-control" placeholder="Appartments, suite, unit etc ..." required>  -->

	            						<div class="row">

		                					<!-- <div class="col-sm-6">
		                						<label>Locality *</label>
		                						<input type="text" class="form-control" name="locality" required>
		                					</div>End .col-sm-6

		                					<div class="col-sm-6">
		                						<label>City *</label>
		                						<input type="text" class="form-control" name="city" required>
		                					</div>End .col-sm-6 -->

		                				</div><!--End .row -->

		                				<div class="row">

		                					<!-- <div class="col-sm-6">
		                						<label>State *</label>
		                						<input type="text" class="form-control" name="state" required>
		                					</div>End .col-sm-6

		                					<div class="col-sm-6">
		                						<label>Pincode *</label>
		                						<input type="tel" class="form-control" name="pincode" required>
		                					</div>End .col-sm-6 -->

		                				</div><!--End .row -->

	                					<!-- <label>Email address *</label>
	        							<input type="email" class="form-control" required> 

	        							 <div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input" id="checkout-create-acc">
											<label class="custom-control-label" for="checkout-create-acc">Create an account?</label>
										</div>End .custom-checkbox

										<div class="custom-control custom-checkbox">
											<input type="checkbox" class="custom-control-input" id="checkout-diff-address">
											<label class="custom-control-label" for="checkout-diff-address">Ship to a different address?</label>
										</div>End .custom-checkbox -->

	                					<!-- <label>Address</label> -->

	        							<!-- <textarea class="form-control" cols="30" rows="4" name="address" placeholder="enter your address"></textarea> -->

									</div><!--End .col-lg-9-->

					<% } %>

					<!-- <form > -->

						<aside class="col-lg-3">
							
						<form action="/getOrder" method="post" id="myForm">

		                			<div class="summary">
		                				<h3 class="summary-title">Your Order</h3><!-- End .summary-title -->

		                				<table class="table table-summary">
		                					<thead>
		                						<tr>
		                							<th>Product</th>
		                							<th>Total</th>
		                						</tr>
		                					</thead>

											<tbody>

												
                                                    <% cartData?.products?.forEach((product, index)=> { %>

                                                

                                                    <% }) %>

                                                            <tr class="summary-subtotal">

                                                                <td>Subtotal:</td>

                                                            <% if (cartData.coupenDisPrice >= 1) { %>

																<td>$<%= cartData?.Total_price + cartData.coupenDisPrice %></td>
																
																
															<%	} else { %>
																

																<td>$<%= cartData?.Total_price %>.00</td>
																
																
															
															<% } %>

                                                            </tr><!-- End .summary-subtotal -->
															

                                                        <% if (cartData.coupenDisPrice >= 1) { %>

															<tr>
                                                                <td>Coupen Offer:</td>

                                                                <td class="text-success">- $<%= cartData.coupenDisPrice %>.00</td>

                                                            </tr>
																
														<%	} %>

                                                            <tr class="summary-total">

                                                                <td>Total:</td>
                                                                																	
																<td>$<%= cartData?.Total_price %>.00</td>

                                                            </tr><!-- End .summary-total -->
															
                                                </tbody>
		                				
		                				</table><!-- End .table table-summary -->

											<div class="accordion-summary" id="accordion-payment">

												<div class="card">

													<% if (cartData?.Total_price <= 1000) { %>

													<div class="card-header" id="heading-1">

														<h2 class="card-title">

															<input type="radio" name="peyment" value="Cash on Delivery" checked class="bg-primary">

															<label for="">Cash on Delivery</label>

														</h2>

													</div>
														
												<% } else { %>

													<div class="card-header" id="heading-1">

														<h2 class="card-title">

															<input type="radio" name="peyment" value="Cash on Delivery" disabled class="bg-primary opacity-50">

															

															<label for="" style="text-decoration:line-through;">Cash on Delivery</label>

														</h2>

													</div>

												<% } %>
													
													<br>

													<% if (!locals.walletData || cartData.Total_price >= locals.walletData?.balance || locals.walletData?.balance == 0 ) { %>
														
													<div class="card-header" id="heading-1">

                                                        <h2 class="card-title">

                                                            <input type="radio" name="peyment" id="wallet"

                                                                value="wallet" disabled class="bg-primary opacity-50 " >

                                                            <label for="wallet" class="" style="text-decoration:line-through;">wallet</label>

                                                        </h2>

                                                    </div>

												<%	} else { %>

													 <div class="card-header" id="heading-1">

                                                        <h2 class="card-title">

                                                            <input type="radio" name="peyment" id="wallet" value="wallet" class="bg-primary">

                                                            <label for="wallet">wallet</label>

                                                        </h2>

                                                    </div>
														
												<% } %>
													
													<!-- <input type="text" name="" id="" onclick="submit()" hidden > -->
													<!-- End .card-header -->
												
													<br>

													<div class="card-header" id="heading-1">

														<h2 class="card-title">

															<input type="radio" value="Online Peyment" name="peyment" 

															class="bg-primary">

															<label for="online">Online Payment</label>

														</h2>

													</div><!-- End .card-header -->

												</div><!-- End .card -->
													
												</div><!-- End .accordion -->

											<div>
														<span id="placeOrder-error"></span>
												<button type="button" onclick="sumbitPayment('<%= userData?._id %>',' <%= cartData?.Total_price %>')" class="btn btn-outline-primary-2 btn-order btn-block">

													<span class="btn-text">Place Order</span>
													<span class="btn-hover-text">Proceed to Checkout</span>

												</button>

											</div>
										
		                			</div><!-- End .summary -->

								</form>

		                	</aside><!-- End .col-lg-3 -->

						<!-- </form> -->

	                </div><!-- End .container -->
                </div><!-- End .checkout -->
            </div><!-- End .page-content -->
        </main><!-- End .main -->

	<!-- Connect Footer -->
		
		<!-- Connect Footer -->
     
	</div><!-- End .page-wrapper -->

    <button id="scroll-top" title="Back to Top"><i class="icon-arrow-up"></i></button>

		<!--Connect Mobaile View-->
        <%- include('../layouts/mobileView.ejs') %>
		<!--Connect Mobaile View-->

    <!-- Plugins JS File -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/jquery.hoverIntent.min.js"></script>
    <script src="assets/js/jquery.waypoints.min.js"></script>
    <script src="assets/js/superfish.min.js"></script>
    <script src="assets/js/owl.carousel.min.js"></script>
    <!-- Main JS File -->
    <script src="assets/js/main.js"></script>

	<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
  
  //  Add Address Section :-

  function addAddress(id){

      const form = document.getElementById('addform');

      const formData = new FormData(form)
      const addressData = {}
      
      formData.forEach((value , key) => {

        addressData[key] = value;
        
      });

    fetch(`/verifyChekutAdss?id=${id}` , {method : 'post' , headers : {'Content-Type' : 'application/json'} , body:JSON.stringify({addressData})})

    .then(res => res.json()).then(data => {

      if(data.success){

        Swal.fire({
     
         title:'Address Added',
         text:'Address Added Successfully',
         icon:'success',
         confirmButtonText: 'OK'
     
        }).then((result) => {
 
         window.location.href = '/checkout'
         
        })

      } else {
    
        Swal.fire({
        
          title:'Failed',
          text:'Address Adding Failed',
          icon:'error',
          confirmButtonText: 'OK'
        
        }).then((result) => {
    
         window.location.href = '/checkout'
            
        })

      }

    })

}

//	Delete Address :-

function deleteAdd(id , addId){

   fetch(`deleteCheckAdd?id=${id}&&userid=${addId}` , {method : 'post'})

  .then(data =>{

   if(data.ok){

     Swal.fire({

		title: "Are you sure?",
		text: "You won't be able to delete this address!",
		icon: "warning",
		showCancelButton: true,
		confirmButtonColor: "#3085d6",
		cancelButtonColor: "#d33",
		confirmButtonText: "Yes, delete it!"

	}) .then((result) => {

			if (result.isConfirmed) {
			
				Swal.fire({
				
					title: "Deleted!",
					text: "Your Address has been deleted.",
					icon: "success"

				}).then((result) => {
    
         			window.location.href = '/checkout'
            
      			})

			}

	    })

    }

  })

};

//  Edit Address :-

function editAddress(edit){

	const namee = document.getElementById('namee')
	const phonee = document.getElementById('phonee')
	const localityy = document.getElementById('localityy')
	const pincodee = document.getElementById('pincodee')
	const addressss = document.getElementById('addresssss')
	const cityy = document.getElementById('cityy')
	const statee = document.getElementById('statee')
	const idd = document.getElementById('idd');

  fetch('/editAddressCheckout' , {method : 'put'  , headers : {'Content-Type': 'application/json'} , body : JSON.stringify({edit})})

  .then((res) => res.json())

  .then((data) =>{

    const {name , phone , locality , pincode , address , city , state , _id} = data.editData.addresss[0];

    namee.value = name
    phonee.value = phone
    pincodee.value = pincode
    localityy.value = locality
    addressss.value = address
    cityy.value = city
    statee.value = state
    idd.value = _id

  })

};

//	Address Choose :-

function addresChoose(id){

	fetch(`/chooseAddress?id=${id}` , {method : 'post' , headers : {'Content-Type': 'application/json'}})

	window.location.href = '/checkout'

}

//	Sweet Alert For Edit Address :-

const msg = document.getElementById('msg');

if(msg.textContent == 'Address Edited'){

	 Swal.fire({
     
        title:'Address Edited',
        text:'Address Edited Successfully',
        icon:'success',
        confirmButtonText: 'OK'
     
    })

} else if(msg.textContent == 'Cart Empty'){


	Swal.fire({

		icon: "error",
		title: "Oops...",
		text: "Your Cart Is Empty!",
		footer: '<a href="/product">Why do I have this issue?</a>'

	});


} else if(msg.textContent == 'No Address'){


	Swal.fire({

		icon: "error",
		title: "Oops...",
		text: "Please Add Address!",
		footer: '<a href="/checkout">Why do I have this issue?</a>'

	});

} else if(msg.textContent == 'coupen'){

	const Toast = Swal.mixin({

		toast: true,
		position: "top-end",
		showConfirmButton: false,
		timer: 3000,
	    timerProgressBar: true,

		didOpen: (toast) => {

			toast.onmouseenter = Swal.stopTimer;
		   toast.onmouseleave = Swal.resumeTimer;
		}

	});
					
	Toast.fire({

		icon: "success",
		title: "Coupen Applied"		

	});
		
} else if(msg.textContent == 'usedOne'){

	const Toast = Swal.mixin({

		toast: true,
		position: "top-end",
		showConfirmButton: false,
		timer: 3000,
	    timerProgressBar: true,

		didOpen: (toast) => {

			toast.onmouseenter = Swal.stopTimer;
		   toast.onmouseleave = Swal.resumeTimer;
		}

	});
					
	Toast.fire({

		icon: "warning",
		title: "Already Used!!!"		

	});

}

//	Payment Sumbit :-

function sumbitPayment(amount, userId){
	
	const form = document.getElementById('myForm'); 
    const Radio = document.querySelector('input[name="peyment"]:checked');
    
    if(Radio.value == 'Online Peyment'){

        razorPay(amount, userId)
		
    }else{
		
        form.submit()
		

    }

}

//	RazorPay :-

function razorPay(userId, amount) {

    const form = document.getElementById('myForm');

        fetch('/razorPay', {

            method: 'POST',
            headers: { 'Content-type': 'application/json' },

            body: JSON.stringify({ amount, userId })

        }).then(res => res.json()).then(data => {

            if (data.succes) {

                let options = {

                    "key": `${data.key_id}`,
                    "amount": `${data.amount}`,
                    "currency": "INR",
                    "name": "JERSIFY",
                    "order_id": `${data.order_id}`,

                    "handler": function (response) {

                        form.submit();
                                        
                    },

                        "profile": {

                        "name": `${data.name}`,
                        "email": `${data.email}`
                    }
                }

                let razorpayObject = new Razorpay(options);

				//	Payment Failed Area :- 

                razorpayObject.on('payment.failed', (response) => {		

                   form.action = '/failedRazorpay'
				   form.submit()

                });

                razorpayObject.open();

            } else if(data.emptyCart){

				Swal.fire({

					icon: "error",
					title: "Oops...",
					text: "Your Cart Is Empty!",
					footer: '<a href="/product">Why do I have this issue?</a>'

				});


			} else if(data.noAddress){

				Swal.fire({

					icon: "error",
					title: "Oops...",
					text: "Please Add Address!",
					footer: '<a href="/checkout">Why do I have this issue?</a>'

				});

			}
        })

}

//	Use Coupen :-

function coupenCheck(val){

	const msg = document.getElementById('p')
	const btn = document.getElementById('btn')

	fetch(`/coupenCehck` , {method : 'post' , headers : {'Content-Type' : 'application/json'} , body : JSON.stringify({inpVal : val.value})})

	.then(res => res.json())

	.then(data => {

		if(data.s){

			msg.textContent = 'Valid Coupen'
			msg.classList.remove('text-danger')
			msg.classList.add('text-success')
			btn.disabled = false

		} else if(data.fail) {

			msg.textContent = 'Invalid Coupen'
			msg.classList.remove('text-success')
			msg.classList.add('text-danger')
			btn.disabled = true

		}

	})

}

//	Remove Coupen :-

function removeCoupen(){

	fetch(`/removeCop` , {method : 'put'})

	.then(res => res.json())

	.then(data => {

		console.log("VAVAVAVAVAVVAV");

		if(data.succ){

			window.location.reload()

		}

	})

}

//  Validation For Add Address :-

function validateForm() {
  
  const validId = document.getElementById('validUserId').value

  console.log(validId);

  var inputs = document.getElementById("address").querySelectorAll("input, textarea")

  var isValid = true

    inputs.forEach(function(input) {

      if (input.value.trim() === "") {

        isValid = false;
        return;
      }

    });

    if (!isValid) {

      event.preventDefault(); 
            
      Swal.fire({

        title: "Oops!!!",
        text: "Please Fill All Input Fields",
        icon: "error"

      })

    } else {

		console.log("isvslid ");

      var addressInput = document.getElementById("addresssss")

       event.preventDefault();

      addAddress(validId);

    }

}

</script>

<style>

 .style:hover{
      
   background-color:rgb(239, 239, 239) ;  

}

.style:active{

    background-color: rgb(211, 211, 211);

}

</style>

<script>

  //  Copy Coupen Code :-

   var btn = document.getElementById("cpnBtn");
   var cpnCode = document.getElementById("cpnCode");

    function copyCode(e,elem){

      navigator.clipboard.writeText(e);
      elem.innerHTML ="COPIED";
      
      setTimeout(function(){

        elem.innerHTML="COPY CODE";

      }, 3000);

    }

</script>

<style>

  #cpnCode{
    border: 1px dashed #fff;
    padding: 10px 20px;
	display: none;
    border-right: 0;

}
#cpnBtn{
    border: 1px solid #fff;
    background: #fff;
    padding: 10px 20px;
    color: #000000;
    cursor: pointer;
}

    
.flip-card {

  background-color: transparent;
  width: 150px;
  height: 200px;
  perspective: 1000px;
  font-family: sans-serif;
}

.title {
  font-size: 1.5em;
  font-weight: 900;
  text-align: center;
  margin: 0;
}

.flip-card-inner {
  position: relative;
  width: 100%;
  height: 100%;
  text-align: center;
  transition: transform 0.8s;
  transform-style: preserve-3d;
}

.flip-card:hover .flip-card-inner {
  transform: rotateY(180deg);
}

.flip-card-front, .flip-card-back {
  box-shadow: 0 8px 14px 0 rgba(0,0,0,0.2);
  position: absolute;
  display: flex;
  flex-direction: column;
  justify-content: center;
  width: 100%;
  height: 100%;
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  border: 1px solid coral;
  border-radius: 1rem;
}

.flip-card-front {
  background: linear-gradient(120deg, bisque 60%, rgb(255, 231, 222) 88%,
     rgb(255, 211, 195) 40%, rgba(255, 127, 80, 0.603) 48%);
  color: coral;
}

.flip-card-back {
  background: linear-gradient(120deg, rgb(255, 174, 145) 30%, coral 88%,
     bisque 40%, rgb(255, 185, 160) 78%);
  color: white;
  transform: rotateY(180deg);
}

</style>

<%- include('../layouts/footer1') %>